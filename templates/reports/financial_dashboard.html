{% extends "base/base_dashboard.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Financial Reports Dashboard" %}{% endblock %}

{% block extra_css %}

    <link rel="stylesheet" href="{% static 'css/reports/financial_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-1">
            <i class="bi bi-graph-up text-success me-2"></i>
            {% trans "Financial Reports Dashboard" %}
        </h1>
        <p class="text-muted mb-0">{% trans "Real-time financial analytics and revenue insights" %}</p>
    </div>

    <div class="export-buttons">
        <button class="export-btn" onclick="exportFinancialReport('pdf')">
            <i class="bi bi-file-pdf"></i>
            {% trans "Export PDF" %}
        </button>
        <button class="export-btn" onclick="exportFinancialReport('excel')">
            <i class="bi bi-file-excel"></i>
            {% trans "Export Excel" %}
        </button>
    </div>
</div>

<!-- Financial Summary Cards -->
<div class="row mb-4">
    <div class="col-lg-4 col-md-6">
        <div class="financial-card revenue">
            <div class="financial-value" id="total-revenue">$0.00</div>
            <div class="financial-label">{% trans "Total Revenue" %}</div>
            <div class="financial-period">{% trans "Last 30 days" %}</div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6">
        <div class="financial-card average">
            <div class="financial-value" id="average-daily">$0.00</div>
            <div class="financial-label">{% trans "Daily Average" %}</div>
            <div class="financial-period">{% trans "Last 30 days" %}</div>
        </div>
    </div>

    <div class="col-lg-4 col-md-6">
        <div class="financial-card pending">
            <div class="financial-value" id="pending-bills">$0.00</div>
            <div class="financial-label">{% trans "Pending Bills" %}</div>
            <div class="financial-period">{% trans "Outstanding" %}</div>
        </div>
    </div>
</div>

<!-- Revenue Chart -->
<div class="chart-container">
    <div class="chart-header">
        <div>
            <h3 class="chart-title">{% trans "Revenue Trend" %}</h3>
            <p class="chart-subtitle mb-0">{% trans "Daily revenue analysis over time" %}</p>
        </div>
        <div class="period-buttons">
            <button class="period-btn active" onclick="changePeriod('7days')">7 {% trans "Days" %}</button>
            <button class="period-btn" onclick="changePeriod('30days')">30 {% trans "Days" %}</button>
            <button class="period-btn" onclick="changePeriod('90days')">90 {% trans "Days" %}</button>
        </div>
    </div>

    <div class="loading-spinner" id="chart-loading">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">{% trans "Loading..." %}</span>
        </div>
        <p class="mt-2">{% trans "Loading financial data..." %}</p>
    </div>

    <div class="no-data-message" id="no-data">
        <i class="bi bi-graph-down" style="font-size: 3rem; color: #dee2e6;"></i>
        <h5 class="mt-3">{% trans "No Financial Data" %}</h5>
        <p>{% trans "No revenue data available for the selected period." %}</p>
    </div>

    <canvas id="revenueChart" width="400" height="150"></canvas>
</div>

<!-- Recent Transactions Table -->
<div class="summary-table">
    <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <h4 class="mb-0">
            <i class="bi bi-list-ul me-2"></i>
            {% trans "Recent Financial Activity" %}
        </h4>
        <a href="{% url 'billing:bill_list' %}" class="btn btn-outline-primary btn-sm">
            {% trans "View All Bills" %}
        </a>
    </div>

    <div class="table-responsive">
        <table class="table" id="recent-transactions">
            <thead>
                <tr>
                    <th>{% trans "Date" %}</th>
                    <th>{% trans "Patient" %}</th>
                    <th>{% trans "Bill ID" %}</th>
                    <th>{% trans "Amount" %}</th>
                    <th>{% trans "Status" %}</th>
                    <th>{% trans "Payment Method" %}</th>
                </tr>
            </thead>
            <tbody id="transactions-body">
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">{% trans "Loading..." %}</span>
                            </div>
                            <p class="mt-2">{% trans "Loading recent transactions..." %}</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'vendor/chartjs/chart.js' %}"></script>

    <script src="{% static 'js/reports/financial_dashboard.js' %}"></script>
{% endblock %}
