{% extends 'base/base_dashboard.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "OPD Record Details" %} - {{ opd.patient_name }} - ZAIN HMS{% endblock %}

{% block page_title %}{% trans "OPD Record Details" %}{% endblock %}

{% block extra_css %}
<style>
    .detail-card { border-radius: 12px; }
    .info-label { font-weight: 600; color: #495057; }
    .info-value { color: #212529; }
    .status-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    .timeline-item { border-left: 3px solid #dee2e6; padding-left: 20px; margin-bottom: 20px; position: relative; }
    .timeline-item::before { content: ''; width: 12px; height: 12px; background: #007bff; border-radius: 50%; position: absolute; left: -7.5px; top: 0; }
    .patient-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px 12px 0 0; }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-user-injured me-2"></i>{% trans "OPD Record Details" %}
        </h1>
        <div class="d-flex gap-2">
            <a href="{% url 'opd:opd_update' opd.pk %}" class="btn btn-warning btn-sm shadow-sm">
                <i class="fas fa-edit fa-sm text-white-50"></i> {% trans "Edit Record" %}
            </a>
            <a href="{% url 'opd:opd_full_list' %}" class="btn btn-secondary btn-sm shadow-sm">
                <i class="fas fa-arrow-left fa-sm text-white-50"></i> {% trans "Back to List" %}
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Patient Information Card -->
            <div class="card shadow mb-4 detail-card">
                <div class="card-header patient-header py-4">
                    <div class="row align-items-center">
                        <div class="col">
                            <h3 class="mb-1">
                                <i class="fas fa-user me-2"></i>{{ opd.patient_name }}
                            </h3>
                            <p class="mb-0 opacity-75">
                                {% trans "OPD Record" %} #{{ opd.id }} -
                                {% trans "Created" %} {{ opd.created_at|date:"F d, Y" }}
                            </p>
                        </div>
                        <div class="col-auto">
                            <div class="text-end">
                                {% if opd.priority == 'high' %}
                                    <span class="status-indicator bg-danger"></span>
                                    <span class="badge badge-light">{% trans "High Priority" %}</span>
                                {% elif opd.priority == 'medium' %}
                                    <span class="status-indicator bg-warning"></span>
                                    <span class="badge badge-light">{% trans "Medium Priority" %}</span>
                                {% else %}
                                    <span class="status-indicator bg-success"></span>
                                    <span class="badge badge-light">{% trans "Low Priority" %}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-3">
                                <i class="fas fa-user text-primary me-2"></i>{% trans "Patient Information" %}
                            </h5>
                            <table class="table table-sm table-borderless">
                                <tr>
                                    <td class="info-label">{% trans "Full Name:" %}</td>
                                    <td class="info-value">{{ opd.patient_name }}</td>
                                </tr>
                                <tr>
                                    <td class="info-label">{% trans "Phone:" %}</td>
                                    <td class="info-value">
                                        <i class="fas fa-phone text-primary me-1"></i>{{ opd.patient_phone }}
                                    </td>
                                </tr>
                                {% if opd.patient_email %}
                                <tr>
                                    <td class="info-label">{% trans "Email:" %}</td>
                                    <td class="info-value">
                                        <i class="fas fa-envelope text-secondary me-1"></i>{{ opd.patient_email }}
                                    </td>
                                </tr>
                                {% endif %}
                                {% if opd.patient_age %}
                                <tr>
                                    <td class="info-label">{% trans "Age:" %}</td>
                                    <td class="info-value">{{ opd.patient_age }} {% trans "years" %}</td>
                                </tr>
                                {% endif %}
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3">
                                <i class="fas fa-info-circle text-primary me-2"></i>{% trans "Record Status" %}
                            </h5>
                            <table class="table table-sm table-borderless">
                                <tr>
                                    <td class="info-label">{% trans "Current Status:" %}</td>
                                    <td class="info-value">
                                        {% if opd.status == 'waiting' %}
                                            <span class="badge badge-warning">
                                                <i class="fas fa-clock"></i> {% trans "Waiting" %}
                                            </span>
                                        {% elif opd.status == 'in_progress' %}
                                            <span class="badge badge-info">
                                                <i class="fas fa-spinner"></i> {% trans "In Progress" %}
                                            </span>
                                        {% elif opd.status == 'completed' %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-check-circle"></i> {% trans "Completed" %}
                                            </span>
                                        {% elif opd.status == 'cancelled' %}
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times-circle"></i> {% trans "Cancelled" %}
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-label">{% trans "Assigned Doctor:" %}</td>
                                    <td class="info-value">
                                        {% if opd.doctor %}
                                            <i class="fas fa-user-md text-success me-1"></i>{{ opd.doctor.get_full_name }}
                                        {% else %}
                                            <span class="text-muted">{% trans "Not assigned" %}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-label">{% trans "Payment Status:" %}</td>
                                    <td class="info-value">
                                        {% if opd.is_paid %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-check"></i> {% trans "Paid" %}
                                            </span>
                                        {% else %}
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times"></i> {% trans "Unpaid" %}
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-label">{% trans "Created:" %}</td>
                                    <td class="info-value">{{ opd.created_at|date:"F d, Y H:i" }}</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Information Card -->
            <div class="card shadow mb-4 detail-card">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-stethoscope me-2"></i>{% trans "Medical Information" %}
                    </h6>
                </div>
                <div class="card-body">
                    {% if opd.symptoms %}
                    <div class="mb-4">
                        <h6 class="info-label">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>{% trans "Symptoms" %}
                        </h6>
                        <div class="bg-light p-3 rounded">
                            {{ opd.symptoms|linebreaksbr }}
                        </div>
                    </div>
                    {% endif %}

                    {% if opd.diagnosis %}
                    <div class="mb-4">
                        <h6 class="info-label">
                            <i class="fas fa-list-ul text-info me-2"></i>{% trans "Diagnosis & Treatment" %}
                        </h6>
                        <div class="bg-light p-3 rounded">
                            {{ opd.diagnosis|linebreaksbr }}
                        </div>
                    </div>
                    {% endif %}

                    {% if not opd.symptoms and not opd.diagnosis %}
                    <div class="text-center py-4">
                        <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">{% trans "No medical information recorded yet" %}</h6>
                        <a href="{% url 'opd:opd_update' opd.pk %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-edit"></i> {% trans "Add Medical Information" %}
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Quick Actions Card -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-bolt me-2"></i>{% trans "Quick Actions" %}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'opd:opd_update' opd.pk %}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> {% trans "Edit Record" %}
                        </a>

                        {% if opd.status != 'completed' %}
                        <button class="btn btn-success" onclick="updateStatus('completed')">
                            <i class="fas fa-check"></i> {% trans "Mark as Completed" %}
                        </button>
                        {% endif %}

                        {% if not opd.is_paid %}
                        <button class="btn btn-info" onclick="togglePayment()">
                            <i class="fas fa-credit-card"></i> {% trans "Mark as Paid" %}
                        </button>
                        {% endif %}

                        <button class="btn btn-secondary" onclick="window.print()">
                            <i class="fas fa-print"></i> {% trans "Print Record" %}
                        </button>

                        <a href="{% url 'opd:opd_delete' opd.pk %}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this record?')">>
                            <i class="fas fa-trash"></i> {% trans "Delete Record" %}
                        </a>
                    </div>
                </div>
            </div>

            <!-- Record Timeline Card -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-history me-2"></i>{% trans "Record Timeline" %}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Record Created" %}</h6>
                            <small class="text-muted">{{ opd.created_at|date:"F d, Y H:i" }}</small>
                            <p class="mb-0 mt-1">{% trans "OPD record created in the system" %}</p>
                        </div>

                        {% if opd.doctor %}
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Doctor Assigned" %}</h6>
                            <small class="text-muted">{{ opd.created_at|date:"F d, Y H:i" }}</small>
                            <p class="mb-0 mt-1">{% trans "Assigned to" %} {{ opd.doctor.get_full_name }}</p>
                        </div>
                        {% endif %}

                        {% if opd.status == 'completed' %}
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Consultation Completed" %}</h6>
                            <small class="text-muted">{{ opd.updated_at|date:"F d, Y H:i" }}</small>
                            <p class="mb-0 mt-1">{% trans "Medical consultation completed" %}</p>
                        </div>
                        {% endif %}

                        {% if opd.is_paid %}
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Payment Completed" %}</h6>
                            <small class="text-muted">{{ opd.updated_at|date:"F d, Y H:i" }}</small>
                            <p class="mb-0 mt-1">{% trans "Payment processed successfully" %}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateStatus(newStatus) {
    if (confirm('{% trans "Are you sure you want to update the status?" %}')) {
        // This would typically make an AJAX call to update the status
        alert('{% trans "Status update functionality would be implemented here" %}');
    }
}

function togglePayment() {
    if (confirm('{% trans "Mark this record as paid?" %}')) {
        // This would make an AJAX call to toggle payment status
        window.location.reload();
    }
}

// Print styles
window.addEventListener('beforeprint', function() {
    document.body.classList.add('print-mode');
});

window.addEventListener('afterprint', function() {
    document.body.classList.remove('print-mode');
});
</script>

<style>
@media print {
    .btn, .card-header, .timeline, [class*="btn-"] {
        display: none !important;
    }
    .card {
        border: none !important;
        box-shadow: none !important;
    }
    .patient-header {
        background: #f8f9fa !important;
        color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
}
</style>
{% endblock %}
