{% load i18n %}
<div class="table-responsive">
    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
        <thead class="thead-light">
            <tr>
                <th><i class="fas fa-user"></i> {% trans "Patient" %}</th>
                <th><i class="fas fa-phone"></i> {% trans "Contact" %}</th>
                <th><i class="fas fa-user-md"></i> {% trans "Doctor" %}</th>
                <th><i class="fas fa-calendar"></i> {% trans "Date" %}</th>
                <th><i class="fas fa-exclamation-triangle"></i> {% trans "Priority" %}</th>
                <th><i class="fas fa-info-circle"></i> {% trans "Status" %}</th>
                <th><i class="fas fa-credit-card"></i> {% trans "Payment" %}</th>
                <th><i class="fas fa-cogs"></i> {% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for record in opd_records %}
            <tr>
                <td>
                    <strong>{{ record.patient_name }}</strong><br>
                    <small class="text-muted">ID: {{ record.patient_id|default:"N/A" }}</small>
                </td>
                <td>
                    <i class="fas fa-phone text-primary"></i> {{ record.patient_phone }}<br>
                    {% if record.patient_email %}
                    <small><i class="fas fa-envelope text-secondary"></i> {{ record.patient_email }}</small>
                    {% endif %}
                </td>
                <td>
                    {% if record.doctor %}
                        <i class="fas fa-user-md text-success"></i> {{ record.doctor.get_full_name }}
                    {% else %}
                        <span class="text-muted">{% trans "Not assigned" %}</span>
                    {% endif %}
                </td>
                <td>
                    <i class="fas fa-calendar"></i> {{ record.created_at|date:"M d, Y" }}<br>
                    <small class="text-muted">{{ record.created_at|time:"H:i" }}</small>
                </td>
                <td>
                    {% if record.priority == 'high' %}
                        <span class="badge badge-danger priority-high">
                            <i class="fas fa-exclamation-triangle"></i> {% trans "High" %}
                        </span>
                    {% elif record.priority == 'medium' %}
                        <span class="badge badge-warning priority-medium">
                            <i class="fas fa-exclamation-circle"></i> {% trans "Medium" %}
                        </span>
                    {% else %}
                        <span class="badge badge-success priority-low">
                            <i class="fas fa-check-circle"></i> {% trans "Low" %}
                        </span>
                    {% endif %}
                </td>
                <td>
                    {% if record.status == 'waiting' %}
                        <span class="badge badge-warning status-badge">
                            <i class="fas fa-clock"></i> {% trans "Waiting" %}
                        </span>
                    {% elif record.status == 'in_progress' %}
                        <span class="badge badge-info status-badge">
                            <i class="fas fa-spinner"></i> {% trans "In Progress" %}
                        </span>
                    {% elif record.status == 'completed' %}
                        <span class="badge badge-success status-badge">
                            <i class="fas fa-check-circle"></i> {% trans "Completed" %}
                        </span>
                    {% elif record.status == 'cancelled' %}
                        <span class="badge badge-danger status-badge">
                            <i class="fas fa-times-circle"></i> {% trans "Cancelled" %}
                        </span>
                    {% else %}
                        <span class="badge badge-secondary status-badge">
                            <i class="fas fa-question"></i> {{ record.get_status_display }}
                        </span>
                    {% endif %}
                </td>
                <td>
                    <span class="payment-status"
                          hx-post="{% url 'opd:toggle_payment' record.pk %}"
                          hx-target="this"
                          hx-swap="outerHTML"
                          style="cursor: pointer;">
                        {% if record.is_paid %}
                            <span class="badge badge-success">
                                <i class="fas fa-check"></i> {% trans "Paid" %}
                            </span>
                        {% else %}
                            <span class="badge badge-danger">
                                <i class="fas fa-times"></i> {% trans "Unpaid" %}
                            </span>
                        {% endif %}
                    </span>
                </td>
                <td>
                    <div class="btn-group" role="group" aria-label="{% trans 'Record Actions' %}">
                        <a href="{% url 'opd:opd_detail' record.pk %}"
                           class="btn btn-info btn-sm"
                           title="{% trans 'View Details' %}">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{% url 'opd:opd_update' record.pk %}"
                           class="btn btn-warning btn-sm"
                           title="{% trans 'Edit Record' %}">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{% url 'opd:opd_delete' record.pk %}"
                           class="btn btn-danger btn-sm"
                           title="{% trans 'Delete Record' %}"
                           onclick="return confirm('Are you sure you want to delete this record?')">>>
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" class="text-center py-4">
                    <div class="d-flex flex-column align-items-center">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">{% trans "No OPD records found" %}</h5>
                        <p class="text-muted">{% trans "Try adjusting your search criteria or" %}</p>
                        <a href="{% url 'opd:opd_create' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i> {% trans "Create New Record" %}
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
