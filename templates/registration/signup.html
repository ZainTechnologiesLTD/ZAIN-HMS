<!DOCTYPE html>
{% load i18n %}
{% load widget_tweaks %}
{% load static %}
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "Patient Registration" %} - ZAIN HMS</title>

    <!-- Enhanced Meta Tags -->
    <meta name="description" content="{% trans 'Patient registration for ZAIN HMS - Hospital Management System' %}">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">

    <!-- Enhanced CSS Framework -->
    <link href="{% static 'vendor/bootstrap/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Enhanced Icons -->
    <link rel="stylesheet" href="{% static 'vendor/bootstrap-icons/bootstrap-icons.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/fontawesome/all.min.css' %}">

    <!-- Enhanced Web Fonts -->
    <link href="{% static 'fonts/inter.css' %}" rel="stylesheet">

    <!-- Consolidated Public Styles - V2 Modular -->
    <link rel="stylesheet" href="{% static 'css/public/public-v2.css' %}">

    <!-- HTMX Framework -->
    <script src="{% static 'vendor/htmx/htmx.min.js' %}" defer></script>

    <!-- Alpine.js Framework -->
    <script src="{% static 'vendor/alpinejs/alpine.min.js' %}" defer></script>

</head>

<body class="auth-page" x-data="authController()">
    <!-- Unified Header -->
    {% include 'components/public_navbar.html' %}

    <!-- Main Container -->
    <main class="main-container" role="main" aria-labelledby="registerTitle">
        <div class="login-card">
            <div class="login-header">
                <h2 class="login-title" id="registerTitle">{% trans "Join ZAIN HMS" %}</h2>
                <p class="login-subtitle">{% trans "Create your patient account" %}</p>
            </div>

            <!-- Error Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" aria-live="polite">
                        <i class="fas fa-{% if message.tags == 'error' %}exclamation-triangle{% elif message.tags == 'warning' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %} me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Form Errors -->
            {% if form.non_field_errors %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert" aria-live="assertive">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    {% for error in form.non_field_errors %}
                        {{ error }}
                    {% endfor %}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}

            <!-- Registration Form -->
            <form method="post" class="auth-form" novalidate x-data="{ showPassword1: false, showPassword2: false }">
                {% csrf_token %}

                <!-- Personal Information -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="{{ form.first_name.id_for_label }}" class="form-label">
                            <i class="fas fa-user me-2"></i>{% trans "First Name" %}
                        </label>
                        {{ form.first_name|add_class:"form-control" }}
                        {% if form.first_name.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="{{ form.last_name.id_for_label }}" class="form-label">
                            <i class="fas fa-user me-2"></i>{% trans "Last Name" %}
                        </label>
                        {{ form.last_name|add_class:"form-control" }}
                        {% if form.last_name.errors %}
                            <div class="invalid-feedback d-block">
                                {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Username -->
                <div class="mb-3">
                    <label for="{{ form.username.id_for_label }}" class="form-label">
                        <i class="fas fa-user-circle me-2"></i>{% trans "Username" %}
                    </label>
                    {{ form.username|add_class:"form-control" }}
                    {% if form.username.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.username.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label for="{{ form.email.id_for_label }}" class="form-label">
                        <i class="fas fa-envelope me-2"></i>{% trans "Email Address" %}
                    </label>
                    {{ form.email|add_class:"form-control" }}
                    {% if form.email.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.email.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Phone Number -->
                <div class="mb-3">
                    <label for="{{ form.phone.id_for_label }}" class="form-label">
                        <i class="fas fa-phone me-2"></i>{% trans "Phone Number" %}
                    </label>
                    {{ form.phone|add_class:"form-control" }}
                    {% if form.phone.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.phone.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Date of Birth -->
                <div class="mb-3">
                    <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">
                        <i class="fas fa-calendar me-2"></i>{% trans "Date of Birth" %}
                    </label>
                    {{ form.date_of_birth|add_class:"form-control" }}
                    {% if form.date_of_birth.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.date_of_birth.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Gender -->
                <div class="mb-3">
                    <label for="{{ form.gender.id_for_label }}" class="form-label">
                        <i class="fas fa-venus-mars me-2"></i>{% trans "Gender" %}
                    </label>
                    {{ form.gender|add_class:"form-select" }}
                    {% if form.gender.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.gender.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Address -->
                <div class="mb-3">
                    <label for="{{ form.address.id_for_label }}" class="form-label">
                        <i class="fas fa-map-marker-alt me-2"></i>{% trans "Address" %}
                    </label>
                    {{ form.address|add_class:"form-control" }}
                    {% if form.address.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.address.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                    <div class="form-text">
                        <small>{% trans "Optional: Your residential address" %}</small>
                    </div>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label for="{{ form.password1.id_for_label }}" class="form-label">
                        <i class="fas fa-lock me-2"></i>{% trans "Password" %}
                    </label>
                    <div class="input-group">
                        <input :type="showPassword1 ? 'text' : 'password'"
                               name="{{ form.password1.name }}"
                               class="form-control"
                               id="{{ form.password1.id_for_label }}"
                               required
                               autocomplete="new-password">
                        <button class="btn btn-outline-secondary" type="button" @click="showPassword1 = !showPassword1">
                            <i class="fas" :class="showPassword1 ? 'fa-eye-slash' : 'fa-eye'"></i>
                        </button>
                    </div>
                    {% if form.password1.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.password1.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                    <div class="form-text">
                        <small>{% trans "Password must contain at least 8 characters with numbers and letters." %}</small>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="mb-3">
                    <label for="{{ form.password2.id_for_label }}" class="form-label">
                        <i class="fas fa-lock me-2"></i>{% trans "Confirm Password" %}
                    </label>
                    <div class="input-group">
                        <input :type="showPassword2 ? 'text' : 'password'"
                               name="{{ form.password2.name }}"
                               class="form-control"
                               id="{{ form.password2.id_for_label }}"
                               required
                               autocomplete="new-password">
                        <button class="btn btn-outline-secondary" type="button" @click="showPassword2 = !showPassword2">
                            <i class="fas" :class="showPassword2 ? 'fa-eye-slash' : 'fa-eye'"></i>
                        </button>
                    </div>
                    {% if form.password2.errors %}
                        <div class="invalid-feedback d-block">
                            {% for error in form.password2.errors %}{{ error }}{% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Submit Button -->
                <div class="d-grid mb-3">
                    <button type="submit" class="btn btn-primary btn-lg" x-data="{ loading: false }" @click="loading = true" :disabled="loading">
                        <span x-show="!loading">
                            <i class="fas fa-user-plus me-2"></i>{% trans "Create Account" %}
                        </span>
                        <span x-show="loading">
                            <i class="fas fa-spinner fa-spin me-2"></i>{% trans "Creating Account..." %}
                        </span>
                    </button>
                </div>

                <!-- Divider -->
                <div class="divider">
                    <span>{% trans "or" %}</span>
                </div>

                <!-- Google Sign Up -->
                <div class="d-grid mb-3">
                    <button type="button" class="btn btn-google" onclick="signupWithGoogle()">
                        <i class="fab fa-google me-2"></i>{% trans "Continue with Google" %}
                    </button>
                </div>
            </form>

            <!-- Login Link -->
            <div class="text-center">
                <p class="login-link">
                    {% trans "Already have an account?" %}
                    <a href="{% url 'accounts:login' %}" class="fw-semibold">{% trans "Sign In" %}</a>
                </p>
            </div>
        </div>
    </main>

    <!-- Unified Footer -->
    {% include 'components/public_footer.html' %}

    <!-- Enhanced JavaScript Framework -->
    <script src="{% static 'vendor/bootstrap/bootstrap.bundle.min.js' %}"></script>

    <!-- Consolidated Public Scripts - V2 -->
    <script src="{% static 'js/.js' %}"></script>

    <script>
        // Google Sign Up Function
        function signupWithGoogle() {
            /* TODO: Implement Google OAuth with django-allauth
             * 1. Install: pip install django-allauth
             * 2. Add to INSTALLED_APPS: 'allauth', 'allauth.account', 'allauth.socialaccount', 'allauth.socialaccount.providers.google'
             * 3. Configure Google OAuth credentials in settings.py
             * 4. Run migrations: python manage.py migrate
             * 5. Replace this function with proper Google OAuth redirect
             */
            alert('{% trans "Google Sign Up will be available soon!" %}\n\n{% trans "To enable Google Sign Up:" %}\n1. Install django-allauth\n2. Configure Google OAuth credentials\n3. Update this function');
        }

        // Auth Controller for Alpine.js
        function authController() {
            return {
                loading: false,
                showPassword1: false,
                showPassword2: false,

                init() {
                    // Focus management and accessibility
                    const form = document.querySelector('.auth-form');
                    const firstInput = form?.querySelector('input:not([type="hidden"])');

                    if (firstInput) {
                        setTimeout(() => firstInput.focus(), 100);
                    }
                }
            };
        }

        // Form validation and submission
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.auth-form');
            const submitBtn = form?.querySelector('button[type="submit"]');

            if (form && submitBtn) {
                form.addEventListener('submit', function(e) {
                    // Basic client-side validation
                    const password1 = form.querySelector('input[name="password1"]');
                    const password2 = form.querySelector('input[name="password2"]');

                    if (password1 && password2 && password1.value !== password2.value) {
                        e.preventDefault();
                        alert('{% trans "Passwords do not match!" %}');
                        return false;
                    }

                    // Show loading state
                    submitBtn.disabled = true;
                    const loadingText = submitBtn.querySelector('span[x-show="loading"]');
                    const normalText = submitBtn.querySelector('span[x-show="!loading"]');

                    if (loadingText && normalText) {
                        normalText.style.display = 'none';
                        loadingText.style.display = 'inline';
                    }
                });
            }
        });
    </script>
</body>
</html>
