{% extends 'base/base_dashboard.html' %}
{% load static %}
{% block title %}{{ template.name }} - Template Details{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h3 class="mb-1" style="background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:700;">
        {{ template.name }}
      </h3>
      <p class="text-muted mb-0">Communication template details</p>
    </div>
    <div class="d-flex gap-2">
      <a href="{% url 'communications:template_list' %}" class="btn btn-outline-secondary"><i class="bi bi-arrow-left me-1"></i>Back to Templates</a>
      <a href="{% url 'communications:template_edit' template.id %}" class="btn btn-primary"><i class="bi bi-pencil me-1"></i>Edit Template</a>
    </div>
  </div>

  <div class="row">
    <!-- Template Details -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-file-text me-2"></i>Template Information</h5>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-3"><strong>Channel:</strong></div>
            <div class="col-md-9">
              <span class="badge bg-light text-dark border">
                <i class="bi bi-{{ template.channel|default:'chat-dots' }} me-1"></i>{{ template.channel|title }}
              </span>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-3"><strong>Type:</strong></div>
            <div class="col-md-9">{{ template.template_type|default:"General"|title }}</div>
          </div>
          <div class="row mb-3">
            <div class="col-md-3"><strong>Status:</strong></div>
            <div class="col-md-9">
              {% if template.is_active %}
                <span class="badge bg-success">Active</span>
              {% else %}
                <span class="badge bg-secondary">Inactive</span>
              {% endif %}
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-3"><strong>Created:</strong></div>
            <div class="col-md-9">{{ template.created_at|date:'F j, Y \a\t g:i A' }}</div>
          </div>
          <div class="row">
            <div class="col-md-3"><strong>Last Updated:</strong></div>
            <div class="col-md-9">{{ template.updated_at|date:'F j, Y \a\t g:i A' }}</div>
          </div>
        </div>
      </div>

      <!-- Template Content -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-chat-quote me-2"></i>Template Content</h5>
        </div>
        <div class="card-body">
          {% if template.subject_template %}
            <div class="mb-3">
              <label class="form-label fw-semibold">Subject Template:</label>
              <div class="border rounded p-3 bg-light">
                {{ template.subject_template }}
              </div>
            </div>
          {% endif %}

          <div>
            <label class="form-label fw-semibold">Message Template:</label>
            <div class="border rounded p-3 bg-light" style="white-space: pre-wrap;">{{ template.message_template }}</div>
          </div>

          <div class="mt-3">
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Available variables: {patient_name}, {appointment_date}, {appointment_time}, {doctor_name}, {hospital_name}
            </small>
          </div>
        </div>
      </div>
    </div>

    <!-- Usage Stats -->
    <div class="col-lg-4">
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Usage Statistics</h5>
        </div>
        <div class="card-body text-center">
          <div class="display-6 fw-bold text-primary mb-2">{{ usage_count }}</div>
          <p class="text-muted mb-0">Total Uses</p>
        </div>
      </div>

      {% if recent_usage %}
        <div class="card">
          <div class="card-header">
            <h6 class="mb-0"><i class="bi bi-clock me-2"></i>Recent Usage</h6>
          </div>
          <div class="list-group list-group-flush">
            {% for log in recent_usage %}
              <div class="list-group-item px-3 py-2">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="small">
                    <div class="fw-semibold">{{ log.patient.get_full_name|default:"Unknown Patient" }}</div>
                    <div class="text-muted">{{ log.sent_at|date:'M j, g:i A' }}</div>
                  </div>
                  <span class="badge bg-{{ log.status|yesno:'success,danger,warning' }} badge-sm">
                    {{ log.status|title }}
                  </span>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
